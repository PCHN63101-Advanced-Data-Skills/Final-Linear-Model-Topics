
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Unbalanced ANOVA Models &#8212; Linear Models V: Advanced ANOVA Topics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/test.css?v=90b7ad94" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '1.unbalanced-ANOVA';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Follow-up Tests" href="2.follow-up.html" />
    <link rel="prev" title="Introduction" href="0.intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0.intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Linear Models V: Advanced ANOVA Topics - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="Linear Models V: Advanced ANOVA Topics - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0.intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Unbalanced ANOVA Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.follow-up.html">Follow-up Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.advanced-emmeans.html">Advanced Uses of <code class="docutils literal notranslate"><span class="pre">emmeans</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="summary.html">Summary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PCHN63101-Advanced-Data-Skills/Final-Linear-Model-Topics" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PCHN63101-Advanced-Data-Skills/Final-Linear-Model-Topics/issues/new?title=Issue%20on%20page%20%2F1.unbalanced-ANOVA.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/1.unbalanced-ANOVA.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Unbalanced ANOVA Models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-imbalance">The Problem of Imbalance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#venn-diagram-intuition">Venn Diagram Intuition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-principle-of-marginality">The Principle of Marginality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-i-sums-of-squares">Type I Sums-of-squares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-ii-sums-of-squares">Type II Sums-of-squares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-iii-sums-of-squares">Type III Sums-of-squares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sums-of-squares-in-r">Sums-of-Squares in <code class="docutils literal notranslate"><span class="pre">R</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#type-i-and-type-ii-in-r">Type I and Type II in <code class="docutils literal notranslate"><span class="pre">R</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#type-iii-in-r">Type III in <code class="docutils literal notranslate"><span class="pre">R</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-sums-of-squares-circus">The Sums-of-squares Circus</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="unbalanced-anova-models">
<h1>Unbalanced ANOVA Models<a class="headerlink" href="#unbalanced-anova-models" title="Link to this heading">#</a></h1>
<figure class="align-right">
<a class="reference internal image-reference" href="_images/unbalanced-text.webp"><img alt="_images/unbalanced-text.webp" src="_images/unbalanced-text.webp" style="width: 240.0px; height: 360.8px;" /></a>
</figure>
<p>… Indeed, whole textbooks were written about unbalanced data (as can be seen on the <em>right</em>). So this is a topic that deserves some attention, even if it is largely <em>ignored</em> by modern teaching in Psychology. There is something of an assumption that the issues of balance have been <em>solved</em> and thus do not need considering anymore. However, this is not really true. The “solution” implemented by SAS and SPSS is the Type III sums-of-squares, which researchers continue to use because it is the default<a class="footnote-reference brackets" href="#default-foot" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. However, as discussed briefly last week, this approach is highly flawed.</p>
<p>In this part of the lesson, we will dig deeper into the Type I/II/III debate so that you understand what each type of sums-of-squares means, when they are most appropriate to use and what the various arguments are for/against them. In general, we will be recommending Type II for 95% of all use-cases. However, it is important not to just take our word for it. Instead, it is important that you <em>understand</em> the difference and can make your own informed judgement.</p>
<section id="the-problem-of-imbalance">
<h2>The Problem of Imbalance<a class="headerlink" href="#the-problem-of-imbalance" title="Link to this heading">#</a></h2>
<p>The arithmetic behind the traditional ANOVA relates to a simple decomposition of the sums-of-squares. When there are an equal number of data points in each cell (using a 2-way ANOVA as an example), we simply have</p>
<div class="math notranslate nohighlight">
\[
SS_{\text{A}} + SS_{\text{B}} + SS_{\text{AB}} = SS_{\text{Model}}.
\]</div>
<p>So, the total amount of variance explained by the model can be neatly decomposed into several chunks. These decompositions are said to be <em>orthogonal</em>, which you can take to mean <em>independant</em>. The value of each sum-of-squares is not affected by any of the others and they represent a neat and simple partition of the amount explained by the model. Together, we then have</p>
<div class="math notranslate nohighlight">
\[
SS_{\text{Total}} = SS_{\text{Model}} + SS_{\text{Error}}.
\]</div>
<p>Unfortunately, when there is an <em>unequal</em> number of data points across cells, application of the standard ANOVA equations results in</p>
<div class="math notranslate nohighlight">
\[
SS_{\text{A}} + SS_{\text{B}} + SS_{\text{AB}} &gt; SS_{\text{Model}}.
\]</div>
<p>Adding these decompositions together is now <em>not</em> the same as the amount of variance explained by the model. What happens is that the effects “bleed” into each other. They no longer represent an independent partition of the variance. A lack of balance kills the symmetry that allows the ANOVA to neatly decompose the variance. What this means practically is that each effect now contains some element of the other effects and adding them together means we double-count some chunks of variance. This leads to a larger sum <span class="math notranslate nohighlight">\(\left(SS_{\text{A}} + SS_{\text{B}} + SS_{\text{AB}}\right)\)</span> than the model actually explains.</p>
<p>What does this mean in terms of applying an ANOVA model to unbalanced data? It means that each sums-of-squares we calculate is influenced <em>by the other terms in the model</em>. This means we have several options when we decompose the sums-of-squares related to what else is in the model at the time. Each chunk that gets calculated will represent the variance associated with a given effect <em>minus</em> the overlap with anything else in the model. Unfortunately, wherever there is choice, there is also disagreement. For an unbalance ANOVA, this disagreement surrounds three possible ways of decomposing the sums-of-squares in an unbalanced ANOVA model. These are known as Type I, Type II and Type III sums-of-squares and will be the focus of this part of the lesson.</p>
<section id="venn-diagram-intuition">
<h3>Venn Diagram Intuition<a class="headerlink" href="#venn-diagram-intuition" title="Link to this heading">#</a></h3>
<p>Perhaps the simplest way to gain intuition about what happens in an unbalanced ANOVA is to return to the Venn diagram visualisation we saw previously in multiple regression. Here, each circle represents the sum-of-squares associated with each main effect <span class="math notranslate nohighlight">\(\text{A}\)</span> and <span class="math notranslate nohighlight">\(\text{B}\)</span>, along with their interaction <span class="math notranslate nohighlight">\(\text{AB}\)</span>.</p>
<p>When the ANOVA is <em>balanced</em>, the situation is as shown below</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/orthog-ANOVA.png"><img alt="_images/orthog-ANOVA.png" src="_images/orthog-ANOVA.png" style="width: 342.1px; height: 326.15000000000003px;" /></a>
</figure>
<p>Here, there is no overlap between the circles. Each effect is completely independant and it does not mater what else is in the model at the point where we calculate its sum-of-squares. We could entirely remove <span class="math notranslate nohighlight">\(\text{B}\)</span> and <span class="math notranslate nohighlight">\(\text{AB}\)</span> when calculating <span class="math notranslate nohighlight">\(SS_{\text{A}}\)</span> and it would not make any difference. The other model terms therefore do not matter<a class="footnote-reference brackets" href="#modterms-foot" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
<p>When the ANOVA is <em>unbalanced</em>, the situation is as shown below</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/unbalanced-ANOVA.png"><img alt="_images/unbalanced-ANOVA.png" src="_images/unbalanced-ANOVA.png" style="width: 272.25px; height: 266.75px;" /></a>
</figure>
<p>Here, the effects now <em>overlap</em>. This means there is some element of both <span class="math notranslate nohighlight">\(\text{B}\)</span> and <span class="math notranslate nohighlight">\(\text{AB}\)</span> inside the sum-of-squares for <span class="math notranslate nohighlight">\(\text{A}\)</span>. This tells us why the sum of these terms is too big. If we sum the area of the <span class="math notranslate nohighlight">\(\text{A}\)</span> circle, <span class="math notranslate nohighlight">\(\text{B}\)</span> circle and <span class="math notranslate nohighlight">\(\text{C}\)</span> circle we will double-count the areas of overlap. This will be larger than the total area of all the circles (the <span class="math notranslate nohighlight">\(SS_{\text{Model}}\)</span>). Furthermore, because each sum-of-squares will now depend upon the other terms in the model, we now have several options when it comes to calculating them.</p>
<p>Using <span class="math notranslate nohighlight">\(SS_{\text{A}}\)</span> as an examples, we could</p>
<ul class="simple">
<li><p>Calculate <span class="math notranslate nohighlight">\(SS_{\text{A}}\)</span> with nothing else in the model</p></li>
<li><p>Calculate <span class="math notranslate nohighlight">\(SS_{\text{A}}\)</span> with <span class="math notranslate nohighlight">\(\text{B}\)</span> in the model, but no <span class="math notranslate nohighlight">\(\text{AB}\)</span>.</p></li>
<li><p>Calculate <span class="math notranslate nohighlight">\(SS_{\text{A}}\)</span> with <em>both</em> <span class="math notranslate nohighlight">\(\text{B}\)</span> and <span class="math notranslate nohighlight">\(\text{AB}\)</span> in the model.</p></li>
</ul>
<p>In each case, the <span class="math notranslate nohighlight">\(SS_{\text{A}}\)</span> will represent only the <em>unique</em> portion of the cicle, with the overlaps removed. These options are illustrated below and correspond to the Type I, Type II and Type III sums-of-squares.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/SS-Types.png"><img alt="_images/SS-Types.png" src="_images/SS-Types.png" style="width: 515.9000000000001px; height: 221.10000000000002px;" /></a>
</figure>
</section>
</section>
<section id="the-principle-of-marginality">
<h2>The Principle of Marginality<a class="headerlink" href="#the-principle-of-marginality" title="Link to this heading">#</a></h2>
<p>In trying to determine which of the sums-of-squares to choose, we can be guided by the idea of building <em>meaningful</em> models. This is encapsulated by the <em>principle of marginality</em>, which was laid out by <a class="reference external" href="https://www.jstor.org/stable/2344517">Nelder (1977)</a> as a response to his dissatisfaction with the way that linear models were being applied in statistics. In brief, this principle states that <em>if an interaction is in the model, all the constituent lower-order terms must also be in the model</em>.</p>
<p>For example, if we include <span class="math notranslate nohighlight">\(\text{AB}\)</span>, we must also include <span class="math notranslate nohighlight">\(\text{A}\)</span> and <span class="math notranslate nohighlight">\(\text{B}\)</span>. If we include <span class="math notranslate nohighlight">\(\text{ABC}\)</span> we must also include <span class="math notranslate nohighlight">\(\text{A}\)</span>, <span class="math notranslate nohighlight">\(\text{B}\)</span>, <span class="math notranslate nohighlight">\(\text{C}\)</span>, <span class="math notranslate nohighlight">\(\text{AB}\)</span>, <span class="math notranslate nohighlight">\(\text{AC}\)</span>, <span class="math notranslate nohighlight">\(\text{BC}\)</span>. From this perspective, interpretation flows <em>downwards</em>. We interpret the highest-order significant terms and ignore any lower-order terms that are nested inside it. We must start at the <em>bottom</em> of the ANOVA table and work our way up, respecting marginality along the way. This reflects the fact that removing a lower-order term destroys the meaning of the interaction term. Remember, an interaction is defined as a <em>departure from additivity</em>. Without the additive components present in the model, this deviation has no meaning.</p>
<p>For instance, if we fit the model</p>
<div class="math notranslate nohighlight">
\[
y_{ijk} = \mu + \beta_{k} + (\alpha\beta)_{jk} + \epsilon_{ijk},
\]</div>
<p>then there is no main effect of <span class="math notranslate nohighlight">\(\text{A}\)</span>, there is only the main effect of <span class="math notranslate nohighlight">\(\text{B}\)</span> and the <span class="math notranslate nohighlight">\(\text{AB}\)</span> interaction. However, the interaction term <span class="math notranslate nohighlight">\((\alpha\beta)_{jk}\)</span> will no longer behave as a “deviation from additivity”. Instead, it will need to soak-up both the main effect of <span class="math notranslate nohighlight">\(\text{A}\)</span> and the <span class="math notranslate nohighlight">\(\text{AB}\)</span> interaction. So the value of this term will be a combination of the main effect and the interaction, which is uninterpretable. This is all because this model does not respect the principle of marginality and thus the clean interpretation of each term is destroyed. Although the model above does not seem sensible, we will see below that the Type III sums-of-squares actually make <em>implicit</em> comparisons with these forms of models.</p>
</section>
<section id="type-i-sums-of-squares">
<h2>Type I Sums-of-squares<a class="headerlink" href="#type-i-sums-of-squares" title="Link to this heading">#</a></h2>
<p>With some intuition about the problem of imbalance, and armed with the principle of marginality, we can now explore our options for deriving sums-of-squares in unbalanced models. We will start with Type I. As indicated above, the Type I sums-of-squares for factor <span class="math notranslate nohighlight">\(\text{A}\)</span> are calculated based on nothing else being in the model. However, this does not tell the full story. To understand the Type I effects more clearly, it is useful to introduce some new notation. In comparing the following two models</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    \mathcal{M}_{0} &amp;: y_{ijk} = \mu + \beta_{k} + \epsilon_{ijk} \\
    \mathcal{M}_{1} &amp;: y_{ijk} = \mu + \alpha_{j} + \beta_{k} + \epsilon_{ijk} \\
\end{alignat*}
\end{split}\]</div>
<p>we can denote the <em>reduction</em> in residual sums-of-squares as follows</p>
<div class="math notranslate nohighlight">
\[
R(\alpha|\beta).
\]</div>
<p>This is read as “the reduction in residual sums-of-squares for <span class="math notranslate nohighlight">\(\alpha\)</span>, after taking <span class="math notranslate nohighlight">\(\beta\)</span> into account”. So the terms on the <em>left</em> of <span class="math notranslate nohighlight">\(|\)</span> are added and removed between the two models, whereas the terms on the <em>right</em> of <span class="math notranslate nohighlight">\(|\)</span> remain in both models.</p>
<p>With this in mind, the Type I sums-of-squares are a <em>sequential</em> decomposition, where terms are added <em>in the same order</em> as the model equation. Thus, for a 2-way ANOVA, the sums-of-squares for each term are as follows</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    SS_{\text{A}}  &amp;: R(\alpha|\mu)        \\
    SS_{\text{B}}  &amp;: R(\beta|\mu, \alpha) \\
    SS_{\text{AB}} &amp;: R((\alpha\beta)|\mu, \alpha, \beta)
\end{alignat*}
\end{split}\]</div>
<p>As such, the order of the model equation matters here. Each term is added <em>in turn</em> and then compared to the previous model. So we start with only <span class="math notranslate nohighlight">\(\mu\)</span>, we then add <span class="math notranslate nohighlight">\(\alpha\)</span> and see what the difference is. We then add <span class="math notranslate nohighlight">\(\beta\)</span> and see what the difference is from the previous model. Finally, we add the interaction and see what the difference is from the previous model. Written long-hand, this would be:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
SS_{\text{A}}&amp;
\begin{cases}
  y_{ijk} = \mu + \epsilon_{ijk} \\
  y_{ijk} = \mu + \alpha_{j} + \epsilon_{ijk}   
\end{cases} \\
SS_{\text{B}}&amp;
\begin{cases}
  y_{ijk} = \mu + \alpha_{j} + \epsilon_{ijk} \\
  y_{ijk} = \mu + \alpha_{j} + \beta_{k} + \epsilon_{ijk}   
\end{cases} \\
SS_{\text{AB}}&amp;
\begin{cases}
  y_{ijk} = \mu + \alpha_{j} + \beta_{k} + \epsilon_{ijk} \\
  y_{ijk} = \mu + \alpha_{j} + \beta_{k} + (\alpha\beta)_{jk} + \epsilon_{ijk}
\end{cases}
\end{alignat*}
\end{split}\]</div>
<p>In terms of the Venn diagram intuition, we can see below what the standard order of terms produces in terms of the Type I tests.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/SS-I.png"><img alt="_images/SS-I.png" src="_images/SS-I.png" style="width: 471.5px; height: 210.0px;" /></a>
</figure>
<p>Of these, the test of <span class="math notranslate nohighlight">\(\text{B}\)</span> and <span class="math notranslate nohighlight">\(\text{AB}\)</span> are useful because they take other terms into account. However, the test of <span class="math notranslate nohighlight">\(\text{A}\)</span> is less useful, because it does not take the effect of <span class="math notranslate nohighlight">\(\text{B}\)</span> into account. Importantly, however, this will change entirely if the model is specified in a <em>different</em> order. This reliance on order makes the Type I sums-of-squares dubious in their usefulness. Unfortunately, this is exactly what the <code class="docutils literal notranslate"><span class="pre">anova()</span></code> function from base <code class="docutils literal notranslate"><span class="pre">R</span></code> produces and why this method is not really suitable for <em>unbalanced</em> data. Here, the adherence to marginality depends entirely upon the order in which the terms enter the model and will only produce <em>some</em> useful tests, but not necessarily all.</p>
<div class="info admonition">
<p class="admonition-title">Why does R default to Type I sums-of-squares?</p>
<p>It may seem strange that the <code class="docutils literal notranslate"><span class="pre">anova()</span></code> function would choose to use the Type I sums-of-squares. However, we need to understand that <code class="docutils literal notranslate"><span class="pre">anova()</span></code> is only designed for use on <em>balanced</em> data. With this in mind, the choice of decomposition technique is entirely due to computational ease. The Type I effects are easy to calculate because we simply loop through each term, comparing the change in residual sums-of-squares to the previous model. Under balance, this is identical to the traditional ANOVA decompositon and is also identical to Type II and Type III tests. From this perspective, it is easy to see why <code class="docutils literal notranslate"><span class="pre">anova()</span></code> does things this way. However, it is important to understand that this should not be used with <em>unbalanced</em> data. At least, not without understanding what the tests actually mean.</p>
</div>
</section>
<section id="type-ii-sums-of-squares">
<h2>Type II Sums-of-squares<a class="headerlink" href="#type-ii-sums-of-squares" title="Link to this heading">#</a></h2>
<p>Moving on to Type II, these sums-of-squares have a <em>strict</em> adherence to marginality. Indeed, these are the only tests that do this and is the reason why they are the recommended approach. In brief, each Type II effect is tested based on a model that contains none of its <em>higher-order</em> relatives. We will unpack what this means in more detail in this section.</p>
<p>As an example, in the 2-way ANOVA we have the effects <span class="math notranslate nohighlight">\(\text{A}\)</span>, <span class="math notranslate nohighlight">\(\text{B}\)</span> and <span class="math notranslate nohighlight">\(\text{AB}\)</span>. If we wanted to test <span class="math notranslate nohighlight">\(\text{A}\)</span> then the Type II tests would include all the <em>lower-order</em> terms and <em>same-order</em> terms, but none of the <em>higher-order</em> terms that involve <span class="math notranslate nohighlight">\(\text{A}\)</span>. This would mean including <span class="math notranslate nohighlight">\(\text{B}\)</span> but <em>not</em> <span class="math notranslate nohighlight">\(\text{AB}\)</span>. Similarly, the Type II test of <span class="math notranslate nohighlight">\(\text{B}\)</span> would include <span class="math notranslate nohighlight">\(\text{A}\)</span>, but <em>not</em> <span class="math notranslate nohighlight">\(\text{AB}\)</span>. Finally, the test of <span class="math notranslate nohighlight">\(\text{AB}\)</span> would include both <span class="math notranslate nohighlight">\(\text{A}\)</span> <em>and</em> <span class="math notranslate nohighlight">\(\text{B}\)</span>. In this scheme, the sums-of-squares would be</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    SS_{\text{A}}  &amp;: R(\alpha|\mu, \beta)        \\
    SS_{\text{B}}  &amp;: R(\beta|\mu, \alpha) \\
    SS_{\text{AB}} &amp;: R((\alpha\beta)|\mu, \alpha, \beta)
\end{alignat*}
\end{split}\]</div>
<p>Long-hand, this gives:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
SS_{\text{A}}&amp;
\begin{cases}
  y_{ijk} = \mu + \beta_{k} + \epsilon_{ijk} \\
  y_{ijk} = \mu + \alpha_{j} + \beta_{k} + \epsilon_{ijk}   
\end{cases} \\
SS_{\text{B}}&amp;
\begin{cases}
  y_{ijk} = \mu + \alpha_{j} + \epsilon_{ijk} \\
  y_{ijk} = \mu + \alpha_{j} + \beta_{k} + \epsilon_{ijk}   
\end{cases} \\
SS_{\text{AB}}&amp;
\begin{cases}
  y_{ijk} = \mu + \alpha_{j} + \beta_{k} + \epsilon_{ijk} \\
  y_{ijk} = \mu + \alpha_{j} + \beta_{k} + (\alpha\beta)_{jk} + \epsilon_{ijk}
\end{cases}
\end{alignat*}
\end{split}\]</div>
<p>So, notice that the main effects are tested <em>assuming their interaction is 0</em>.</p>
<p>In general, for a given effect <span class="math notranslate nohighlight">\(T\)</span> the Type II rule is that the model comparison is based on including all lower-order terms, all same-order terms and all higher-order terms that <em>do not</em> contain <span class="math notranslate nohighlight">\(T\)</span>. The reason is that this scheme respects marginality. This is the only way to guarantee that each test is always based on an effect that is <em>interpretable</em>. If we make sure we are only ever testing the highest-order effect for the factor in question, it means the hypothesis always has a clear intepretation.</p>
<p>However, just because an effect is <em>interpretable</em> does not necessarily mean it is <em>meaningful</em>. Whether the Type II effects have any useful meaning depends upon the other effects in the ANOVA table. We therefore have to interpret Type II effects hierarchically, from highest-order to lowest-order. Each test only makes sense if its highest-order relatives are null. So, in the 2-way example, we would only interpret the main effects of <span class="math notranslate nohighlight">\(\text{A}\)</span> and <span class="math notranslate nohighlight">\(\text{B}\)</span> if the interaction <span class="math notranslate nohighlight">\(\text{AB}\)</span> were null. This makes sense because</p>
<ul class="simple">
<li><p>If the interaction was <em>significant</em> then the main effects are not meaningful and we would just interpret the interaction on its own.</p></li>
<li><p>If the interaction was <em>non-significant</em>, the only way to interpret the main effects sensibly is in a model <em>without</em> an interaction term (i.e. a purely additive model).</p></li>
</ul>
<p>In terms of our Venn diagram intuition, the Type II tests in the 2-way ANOVA are shown below.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/SS-II.png"><img alt="_images/SS-II.png" src="_images/SS-II.png" style="width: 479.5px; height: 211.5px;" /></a>
</figure>
<p>Here we can see that <span class="math notranslate nohighlight">\(\text{A}\)</span> and <span class="math notranslate nohighlight">\(\text{B}\)</span> are tested controlling for each other, but assuming that <span class="math notranslate nohighlight">\(\text{AB} = 0\)</span>. This makes both <span class="math notranslate nohighlight">\(\text{A}\)</span> and <span class="math notranslate nohighlight">\(\text{B}\)</span> interpretable, but only <em>meaningful</em> if the additive model fits. If it does, we ignore <span class="math notranslate nohighlight">\(\text{AB}\)</span>. If it does not, we ignore <span class="math notranslate nohighlight">\(\text{A}\)</span> and <span class="math notranslate nohighlight">\(\text{B}\)</span> and only interpret <span class="math notranslate nohighlight">\(\text{AB}\)</span>.</p>
</section>
<section id="type-iii-sums-of-squares">
<h2>Type III Sums-of-squares<a class="headerlink" href="#type-iii-sums-of-squares" title="Link to this heading">#</a></h2>
<p>… In terms of their adherence to marginality, the Type III sums-of-squares <em>ignore</em> marginality. Instead choosing to compare models of the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    \mathcal{M}_{0} &amp;: y_{ijk} = \mu + \beta_{k} + (\alpha\beta)_{jk} + \epsilon_{ijk} \\
    \mathcal{M}_{1} &amp;: y_{ijk} = \mu + \alpha_{j} + \beta_{k} + (\alpha\beta)_{jk} + \epsilon_{ijk} \\
\end{alignat*}
\end{split}\]</div>
<p>In other words, by considering a model that contains an interaction, without one of the associated main effects. This is arguably a wholly <em>meaningless</em> model, where we simultaneously suggest that there is 0 difference between the levels of a factor, but also that this difference changes depending upon another factor. What this model comparison ends up calculating is the effect of A after removing the effect of B <em>and</em> AB. So a main effect with the interaction <em>removed</em>. So what exactly does this mean? If we pretend that the effect of A does not depend upon B, what would the effect of A be? If there is a meaningful interaction, this is then calculating a fantasy.</p>
<p>… The problem with the Type III effects is that they try to create something <em>meaningful</em> for every test, but in doing so specify hypotheses that are <em>uninterpretable</em> in the context of the actual data. Trying to derive a main effect test from a model where the interaction is significant is providing an uninterpretable answer to a meaningless question. To bring back the example from last week, if the effectiveness of a treatment depends upon diagnosis, it makes little sense to calculate the effect of treatment <em>ignoring</em> diagnosis. It is like someone asking you whether the treament works. Quite rightly, you say it depends upon diagnosis, so which diagnosis are we talking about? They then just look at you blankly and ask again whether the treatment works.</p>
<p>In this situation, the Type II tests would say “ok, if we set the interaction to 0, this is what we get. However, the interaction is not 0 and an additive model does not fit well here, so we need to ignore this and focus on the interaction”. The Type III tests would say, “ok, well let us correct the main effects for the interaction effect and interpret what is left over”. This is effectively <em>averaging-over</em> the interaction, which can be severly misleading. By doing this, we may well conclude “the treatement does not work”. Except that the treatment <em>does</em> work, but only if you give it to the patients and not the healthy controls. The Type III promise of given interpretable main effects in the presence of an interaction is therefore something of a fantasy.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/SS-III.png"><img alt="_images/SS-III.png" src="_images/SS-III.png" style="width: 473.5px; height: 207.0px;" /></a>
</figure>
</section>
<section id="sums-of-squares-in-r">
<h2>Sums-of-Squares in <code class="docutils literal notranslate"><span class="pre">R</span></code><a class="headerlink" href="#sums-of-squares-in-r" title="Link to this heading">#</a></h2>
<p>We will now turn to how to calculate these various types of sums-of-squares in <code class="docutils literal notranslate"><span class="pre">R</span></code>. In general, both Type I and Type III are of little practical use. As such, we would recommend just using <code class="docutils literal notranslate"><span class="pre">Anova()</span></code> for everything, which will default to Type II. However, there may be times where you wish to generate the other types, so we will see how to do this below.</p>
<p>By way of an example, we will retun the the <span class="math notranslate nohighlight">\(2 \times 3\)</span> ANOVA example from <code class="docutils literal notranslate"><span class="pre">mtcars</span></code>, which we regenerate using the code in the drop-down below.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span>

<span class="c1"># Origin factor</span>
<span class="n">mtcars</span><span class="o">$</span><span class="n">origin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span>
<span class="w">                   </span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span>
<span class="w">                   </span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span>
<span class="w">                   </span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">)</span>
<span class="n">mtcars</span><span class="o">$</span><span class="n">origin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">origin</span><span class="p">)</span>

<span class="c1"># VS factor</span>
<span class="n">vs.lab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="p">))</span><span class="w"> </span>
<span class="n">vs.lab</span><span class="p">[</span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;V-shaped&quot;</span>
<span class="n">vs.lab</span><span class="p">[</span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Straight&quot;</span>
<span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">vs.lab</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We can examine the degree of imbalance in these data using the <code class="docutils literal notranslate"><span class="pre">tables()</span></code> function to generate a contingency table of the factors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">with</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span><span class="n">vs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        vs
origin   Straight V-shaped
  Europe        8        6
  Japan         3        2
  USA           3       10
</pre></div>
</div>
</div>
</div>
<p>So we can see that this is <em>severely</em> unbalanced. We fit the model below and will then examine the different types of sums-of-squares.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mpg.mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">origin</span><span class="o">:</span><span class="n">vs</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="type-i-and-type-ii-in-r">
<h3>Type I and Type II in <code class="docutils literal notranslate"><span class="pre">R</span></code><a class="headerlink" href="#type-i-and-type-ii-in-r" title="Link to this heading">#</a></h3>
<p>Type I and II sums-of-sqaures are simple to produce. For Type I, we can use the built-in <code class="docutils literal notranslate"><span class="pre">anova()</span></code> function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="nf">anova</span><span class="p">(</span><span class="n">mpg.mod</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Analysis of Variance Table

Response: mpg
          Df Sum Sq Mean Sq F value    Pr(&gt;F)    
origin     2 393.88 196.938 11.4370 0.0002733 ***
vs         1 282.26 282.261 16.3921 0.0004117 ***
origin:vs  2   2.21   1.104  0.0641 0.9380730    
Residuals 26 447.70  17.219                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre></div>
</div>
</div>
</div>
<p>These sums-of-squares can be reproduced using model comparisons, based on sequentially adding terms to each model. In the code below, we replicate the values in the <code class="docutils literal notranslate"><span class="pre">Sum</span> <span class="pre">Sq</span></code> column given above. This is just to illustrate the interpretation of the Type I effects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mod.0</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">      </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">mod.1</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">SS.origin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.0</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="n">mod.0</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w">      </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">mod.1</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">SS.vs</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.0</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="n">mod.0</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="p">,</span><span class="w">             </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">mod.1</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">origin</span><span class="o">:</span><span class="n">vs</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">SS.inter</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.0</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">SS.origin</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">SS.vs</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">SS.inter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 393.8751
[1] 282.2613
[1] 2.207004
</pre></div>
</div>
</div>
</div>
<p>Note that we cannot recreate the Type I test using comparisons within the <code class="docutils literal notranslate"><span class="pre">anova()</span></code> function, as only the sums-of-squares will agree. All these tests use the error term from the model containing <em>all</em> the factors. So we can recreate the <em>numerators</em> of the <span class="math notranslate nohighlight">\(F\)</span>-statistics, but the denominators will be different in all but the final comparison.</p>
<p>For Type II, we can use <code class="docutils literal notranslate"><span class="pre">Anova()</span></code> from <code class="docutils literal notranslate"><span class="pre">car</span></code> without any options, as the Type II tests are the default. We can also specify <code class="docutils literal notranslate"><span class="pre">type='II'</span></code>, if we want to be explicit about it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">Anova</span><span class="p">(</span><span class="n">mpg.mod</span><span class="p">))</span><span class="w"> </span><span class="c1"># or Anova(mpg.mod, type=&quot;II&quot;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading required package: carData
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Anova Table (Type II tests)

Response: mpg
          Sum Sq Df F value    Pr(&gt;F)    
origin    179.61  2  5.2153 0.0124621 *  
vs        282.26  1 16.3921 0.0004117 ***
origin:vs   2.21  2  0.0641 0.9380730    
Residuals 447.70 26                      
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre></div>
</div>
</div>
</div>
<p>Again, we can recreate the <code class="docutils literal notranslate"><span class="pre">Sum</span> <span class="pre">sq</span></code> column manually, just to make the logic clear.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mod.0</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">vs</span><span class="p">,</span><span class="w">          </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">mod.1</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">SS.origin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.0</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="n">mod.0</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w">      </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">mod.1</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">SS.vs</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.0</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="n">mod.0</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="p">,</span><span class="w">             </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">mod.1</span><span class="w">     </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">origin</span><span class="o">:</span><span class="n">vs</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span>
<span class="n">SS.inter</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.0</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">mod.1</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">SS.origin</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">SS.vs</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">SS.inter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1] 179.6085
[1] 282.2613
[1] 2.207004
</pre></div>
</div>
</div>
</div>
<p>As expected, both <code class="docutils literal notranslate"><span class="pre">origin:vs</span></code> and <code class="docutils literal notranslate"><span class="pre">vs</span></code> are the same as the Type I tests, but <code class="docutils literal notranslate"><span class="pre">origin</span></code> is different. Refer back to the Venn diagrams to see why this is the case.</p>
</section>
<section id="type-iii-in-r">
<h3>Type III in <code class="docutils literal notranslate"><span class="pre">R</span></code><a class="headerlink" href="#type-iii-in-r" title="Link to this heading">#</a></h3>
<p>For Type III, things get trickier. Recall from above that a Type III main effect is making the implicit comparison</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat*}{1}
    \mathcal{M}_{0} &amp;: y_{ijk} = \mu + \beta_{k} + (\alpha\beta)_{jk} + \epsilon_{ijk} \\
    \mathcal{M}_{1} &amp;: y_{ijk} = \mu + \alpha_{j} + \beta_{k} + (\alpha\beta)_{jk} + \epsilon_{ijk} \\
\end{alignat*}
\end{split}\]</div>
<p>So you might think we can compare <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">A</span> <span class="pre">+</span> <span class="pre">B</span> <span class="pre">+</span> <span class="pre">A:B</span></code> to <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">B</span> <span class="pre">+</span> <span class="pre">A:B</span></code>. Unfortunately, this will not work. … In fact, not actual model comparison exists that will generate the Type III test for us because the models will not behave in the way the Type III tests require. This in and of itself should indicate why Type III is not doing anything sensible. The approach that <code class="docutils literal notranslate"><span class="pre">Anova()</span></code> uses is based on manipulating the model parameters to create the comparison that the Type III tests imply. However, in order to do this correctly, we need to use a <em>very specific dummy coding scheme</em>. …</p>
<p>We have two options here. The first is to change the dummy coding <em>globally</em> using</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">contrasts</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;contr.sum&#39;</span><span class="p">,</span><span class="s">&#39;contr.poly&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The disadvantage of doing this is that this will change the interpretation of the parameters in all the model you use after setting this, unless you remember to set it back to normal afterwards. This means you always need to specify models in the following way</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>

<span class="nf">options</span><span class="p">(</span><span class="n">contrasts</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;contr.sum&#39;</span><span class="p">,</span><span class="s">&#39;contr.poly&#39;</span><span class="p">))</span><span class="w">              </span><span class="c1"># set sum-to-zero coding</span>
<span class="n">mod.sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="o">:</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">)</span><span class="w">   </span><span class="c1"># fit model</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">Anova</span><span class="p">(</span><span class="n">mod.sum</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&#39;III&#39;</span><span class="p">))</span><span class="w">                           </span><span class="c1"># Type III ANOVA table</span>
<span class="nf">options</span><span class="p">(</span><span class="n">contrasts</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;contr.treatment&#39;</span><span class="p">,</span><span class="s">&#39;contr.poly&#39;</span><span class="p">))</span><span class="w">        </span><span class="c1"># puting the coding back to default</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Anova Table (Type III tests)

Response: mpg
             Sum Sq Df  F value    Pr(&gt;F)    
(Intercept) 10488.5  1 609.1096 &lt; 2.2e-16 ***
vs            251.9  1  14.6285 0.0007372 ***
origin        166.5  2   4.8354 0.0163901 *  
vs:origin       2.2  2   0.0641 0.9380730    
Residuals     447.7 26                       
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre></div>
</div>
</div>
</div>
<p>The better approach, though the more messy in terms of syntax, is to tell <code class="docutils literal notranslate"><span class="pre">lm()</span></code> how to code each variable explicitly. This can be done using the <code class="docutils literal notranslate"><span class="pre">contrasts=</span></code> argument, which takes a list of each factor alongside how we want them coded. For this example, we will therefore use</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">mod.sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">mpg</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vs</span><span class="o">:</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span>
<span class="w">              </span><span class="n">contrasts</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">vs</span><span class="o">=</span><span class="n">contr.sum</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">contr.sum</span><span class="p">))</span><span class="w"> </span><span class="c1"># fit model w/specific coding</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">Anova</span><span class="p">(</span><span class="n">mod.sum</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&#39;III&#39;</span><span class="p">))</span><span class="w">                             </span><span class="c1"># Type III ANOVA table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Anova Table (Type III tests)

Response: mpg
             Sum Sq Df  F value    Pr(&gt;F)    
(Intercept) 10488.5  1 609.1096 &lt; 2.2e-16 ***
vs            251.9  1  14.6285 0.0007372 ***
origin        166.5  2   4.8354 0.0163901 *  
vs:origin       2.2  2   0.0641 0.9380730    
Residuals     447.7 26                       
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
</pre></div>
</div>
</div>
</div>
<p>This additional hassle and the dependence of the Type III tests on something as arbitrary as the model coding should be enough to dissuade you from this approach. Indeed, this very dependence is the reason why <code class="docutils literal notranslate"><span class="pre">Anova()</span></code> will <em>not</em> refit the model for you and automatically change the coding. <a class="reference external" href="https://uk.sagepub.com/en-gb/eur/author/john-david-fox">John Fox</a> (the author of <code class="docutils literal notranslate"><span class="pre">car</span></code>) wants this dependence to be clear. Type I and Type II effects do not change with the dummy variable scheme. Type III effects <em>do</em> change. This fact needs to be <em>understood</em>, not <em>hidden</em>.</p>
<p>All that being said, if you want an easier method, there is the <code class="docutils literal notranslate"><span class="pre">ezANOVA()</span></code> function from the <code class="docutils literal notranslate"><span class="pre">ez</span></code> package. This will take care of all the coding mess for you behind the scenes. However, there are some distinct disadvantages here:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ezANOVA</span></code> aims to create output that mimics SPSS. This is not done within the linear models framework, meaning there is not access to residuals, diagnostic plots, parameter estimates or any of the useful output we want. You get an ANOVA table and nothing else<a class="footnote-reference brackets" href="#ez-foot" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p></li>
<li><p>By abstracting away the difficulties of Type III tests, <code class="docutils literal notranslate"><span class="pre">ezANOVA</span></code> gives the impression of simplicity and does not engage you with any of the controversy. It prints a generic warning under imbalance, but nothing else.</p></li>
<li><p>Fundammentally, this package aims to re-express linear models in the language of Psychology and then <em>hide</em> information from you. This is is rarely a good thing. If this is what someone needs in order to use <code class="docutils literal notranslate"><span class="pre">R</span></code>, it is arguable that they should not be using it at all.</p></li>
</ul>
<p>Nevertheless, if you want the simplest possible method of generating a Type III table, you can do the following</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ez</span><span class="p">)</span>

<span class="n">mtcars</span><span class="o">$</span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="o">=</span><span class="nf">dim</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)[</span><span class="m">1</span><span class="p">]))</span><span class="w"> </span><span class="c1"># ezANOVA needs subject IDs</span>
<span class="n">ezAOV</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ezANOVA</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mtcars</span><span class="p">,</span><span class="w">          </span><span class="c1"># data</span>
<span class="w">                      </span><span class="n">dv</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w">               </span><span class="c1"># outcome</span>
<span class="w">                      </span><span class="n">between</span><span class="o">=</span><span class="nf">.</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span><span class="n">origin</span><span class="p">),</span><span class="w"> </span><span class="c1"># between-subject factors  </span>
<span class="w">                      </span><span class="n">wid</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span><span class="w">              </span><span class="c1"># subject IDs</span>
<span class="w">                      </span><span class="n">type</span><span class="o">=</span><span class="m">3</span><span class="p">)</span><span class="w">               </span><span class="c1"># sums-of-squares</span>

<span class="nf">print</span><span class="p">(</span><span class="n">ezAOV</span><span class="o">$</span><span class="n">ANOVA</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Warning message:
“Data is unbalanced (unequal N per group). Make sure you specified a well-considered value for the type argument to ezANOVA().”
Coefficient covariances computed by hccm()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     Effect DFn DFd           F            p p&lt;.05         ges
2        vs   1  26 14.62853431 0.0007372137     * 0.360055674
3    origin   2  26  4.83541867 0.0163900610     * 0.271113270
4 vs:origin   2  26  0.06408491 0.9380730371       0.004905426
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-sums-of-squares-circus">
<h2>The Sums-of-squares Circus<a class="headerlink" href="#the-sums-of-squares-circus" title="Link to this heading">#</a></h2>
<p>… The truth is that the main reason all this hassle exists is because the neat partition of the ANOVA effects disappears when the data are imbalanced. In order to resolve this, we have to choose a method of partitioning the sums-of-squares. The definitions given above come directly from SAS, who’s aim was not some principled statistical derivation that makes sense, rather it was to give their users what they wanted: identical ANOVA output irrespective of balance. Because the traditional ANOVA was not seen as an exercise in model building, it was not typical to remove terms that appeared redundant. In order to maintain this completeness, SAS wanted ANOVA tables that contained <em>all</em> terms, rather than certain terms disappearing under imbalance. As such, different methods for decomposing these effects were developed and a choice was provided.</p>
<p>From a modern perspective, all this hassle is unnecessary if we engage with the process of <em>model building</em>. This is something we will discuss in much greater detail in the machine learning module next semester. However, the idea is very simple. If a term adds little predictive utility, remove it and create the simplest model you can. From this perspective, if the highest-order interaction is <em>small</em> it would be removed and then the lower-order terms become interpretable again. No need for Type II tests to make them intepretable <em>despite</em> the presence of the interaction term. However, if an interaction is <em>large</em>, it stays in the model and we only interpret the highest-order term for each factor. Under this scheme, the whole Type I/II/III debate disappears.</p>
<p>As an example, say we have the model</p>
<div class="math notranslate nohighlight">
\[
Y = A + B + C + AB + AC + BC + ABC.
\]</div>
<p>If the 3-way interaction is uninteresting, we can drop it to form</p>
<div class="math notranslate nohighlight">
\[
Y = A + B + C + AB + AC + BC.
\]</div>
<p>Now, say that <span class="math notranslate nohighlight">\(AC\)</span> and <span class="math notranslate nohighlight">\(BC\)</span> are also uninteresting, we can settle on</p>
<div class="math notranslate nohighlight">
\[
Y = A + B + C + AB.
\]</div>
<p>We would now interpret the 2-way interaction <span class="math notranslate nohighlight">\(AB\)</span> and the main effect <span class="math notranslate nohighlight">\(C\)</span>. Because we have respected marginality here when building these models, all these terms have interpretable effects</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">data</span><span class="p">(</span><span class="n">mtcars</span><span class="p">)</span>

<span class="c1"># Origin factor</span>
<span class="n">mtcars</span><span class="o">$</span><span class="n">origin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span>
<span class="w">                   </span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span>
<span class="w">                   </span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;Japan&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span>
<span class="w">                   </span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;USA&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">,</span><span class="s">&#39;Europe&#39;</span><span class="p">)</span>
<span class="n">mtcars</span><span class="o">$</span><span class="n">origin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">origin</span><span class="p">)</span>

<span class="c1"># VS factor</span>
<span class="n">vs.lab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="nf">length</span><span class="p">(</span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="p">))</span><span class="w"> </span>
<span class="n">vs.lab</span><span class="p">[</span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;V-shaped&quot;</span>
<span class="n">vs.lab</span><span class="p">[</span><span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;Straight&quot;</span>
<span class="n">mtcars</span><span class="o">$</span><span class="n">vs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">vs.lab</span><span class="p">)</span>

<span class="nf">with</span><span class="p">(</span><span class="n">mtcars</span><span class="p">,</span><span class="w"> </span><span class="nf">table</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span><span class="n">vs</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        vs
origin   Straight V-shaped
  Europe        8        6
  Japan         3        2
  USA           3       10
</pre></div>
</div>
</div>
</div>
<aside class="topic">
<p class="topic-title">What do you now know?</p>
<p>In this section, we have explored … After reading this section, you should have a good sense of:</p>
<ul class="simple">
<li><p>…</p></li>
<li><p>…</p></li>
<li><p>…</p></li>
</ul>
</aside>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="default-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Always be wary of defaults. If there is one way of getting an entire scientific field to adhere to a particular way of doing something without the need for any critical evaluation, simply make it the default in software. Defaults do not automatically hold some higher-level of credibility simply because they were the value that the developer picked. Many times these are well-considered, but this is not a <em>guarantee</em>. We can easily be led astray by default choices because we do not have to justify using them. This does not have an official name, but we could perhaps call it <em>the default authority effect</em>. It is effectively a reversal of the burden of proof: deviating from defaults requires defence, whereas using defaults is treated as neutral. Yet this presupposes that the defaults are normatively sound, which is rarely demonstrated or even documented.</p>
</aside>
<aside class="footnote brackets" id="modterms-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>At least in terms of the sums-of-squares and mean-squares. The <span class="math notranslate nohighlight">\(F\)</span>-statistic and <span class="math notranslate nohighlight">\(p\)</span>-value depend on the error sums-of-squares, which will change depending upon the other terms in the model.</p>
</aside>
<aside class="footnote brackets" id="ez-foot" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>A column of effect sizes will also be given (labelled <code class="docutils literal notranslate"><span class="pre">ges</span></code>). We will discuss the nature of omnibus effect sizes later in this lesson.</p>
</aside>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="0.intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="2.follow-up.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Follow-up Tests</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-problem-of-imbalance">The Problem of Imbalance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#venn-diagram-intuition">Venn Diagram Intuition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-principle-of-marginality">The Principle of Marginality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-i-sums-of-squares">Type I Sums-of-squares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-ii-sums-of-squares">Type II Sums-of-squares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#type-iii-sums-of-squares">Type III Sums-of-squares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sums-of-squares-in-r">Sums-of-Squares in <code class="docutils literal notranslate"><span class="pre">R</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#type-i-and-type-ii-in-r">Type I and Type II in <code class="docutils literal notranslate"><span class="pre">R</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#type-iii-in-r">Type III in <code class="docutils literal notranslate"><span class="pre">R</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-sums-of-squares-circus">The Sums-of-squares Circus</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dr Martyn McFarquhar & Dr George Farmer
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025-26.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>